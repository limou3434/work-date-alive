# work-data-alive

## 1.项目目标

基于 ReAct 模式的自主规划智能体 WorkDataAlive：
- 支持用户认证登陆
- 支持对象存储服务
- 支持流量治理服务
- 支持高流点赞服务
- 支持公共频道服务
- 支持智能对话服务

## 2.技术选型

- Java 21 + Spring Boot 3 框架
-️ Spring AI + LangChain4j
-️ RAG 知识库
-️ PGvector 向量数据库
- Tool Calling 工具调用
- MCP 模型上下文协议
- ReAct Agent 智能体构建
- Serverless 计算服务
- AI 大模型开发平台百炼
- Cursor AI 代码生成
- SSE 异步推送
- Ollama 大模型部署
- 第三方接口，如 SearchAPI / Pexels API
- 工具库如，Kryo 高性能序列化 + Jsoup 网页抓取 + iText PDF 生成 + Knife4j 接口文档

## 3.前要知识

### 3.1.AI 的分类

待补充...

### 3.2.AI 的使用

网页端、本地大模型、某些应用内置引入

### 3.3.AI 的引入

- 平台引入，例如：阿里云百炼模型可视化平台、阿里云模型服务灵积 DashScope
- 客户端引入，例如：全能 AI 助手平台 Cherry Studio、编程开发工具 Cursor
- 程序引入，例如：
  - 特定平台提供的 SDK 或 API
  - AI 开发框架，比如 Spring AI、Spring AI Alibaba、LangChain4j

### 3.4.AI 的基础

#### 3.4.1.Token

根据 OpenAI 的文档：

- 英文文本：1 个 token 大约相当于 4 个字符或约 0.75 个英文单词
- 中文文本：1 到 2 个 token 大约相当于一个汉字
- 空格和标点：也会计入 token 数量
- 特殊符号和表情符号：可能需要多个 token 来表示

简单估算一下，100 个英文单词约等于 75-150 个 Token，而 100 个‌中文字符约等于 100-200 个 Token，这里推荐两个计算器：

- [OpenAI 官方 Tokenizer](https://platform.openai.com/tokenizer)：适用于 OpenAI 模型的官方 Token 计算器
- [OpenAI 非官方 Tokenizer](https://tiktoken.aigc2d.com/)：可以用来作为官方的平替版本

估算成本有个公式：总成本 = (输入token数 × 输入单价) + (输出token数 × 输出单价)，但是不同公司计算不同。

Token 很耗费成本，因此就需要优化提示词。

#### 3.4.2.Prompt

学习 Prompt 工程的目标是：通过精心设计和优化输入提示‌来引导 AI 模型生成符合预期的高质量输出。一般会分为以下几种：

- 基于角色的分类（系统、助手、用户）
- 基于功能的分类（角色扮演、场景模拟、样本学习）
- 基于复杂度的分类（简单提示词、复合提示词、链式提示词、模板提示词）

- 一些基础提示词技巧：
  - 尽可能精简系统提示词（不要废话）
  - 明确指定任务和角色（为 AI 提供清晰的任务描述和角色定位，帮助模型理解背景和期望）
  - 提供详细说明和具体示例（提供足够的上下文信息和期望的输出格式示例，减少模型的不确定性）
  - 使用结构化格式引导思维（通过列表、表格等结构化格式，使指令更易理解，输出更有条理）
  - 思维链提示法（引导模型展示推理过程，逐步思考问题，提高复杂问题的准确性）
  - 少样本学习（通过提供几个输入-输出对的例子，帮助模型理解任务模式和期望输出）
  - 分步骤指导（将复杂任务分解为可管理的步骤，确保模型完成每个关键环节）
  - 自我评估和修正（让模型评估自己的输出并进行改进，提高准确性和质量）
  - 知识检索和引用（引导模型检索相关信息并明确引用信息来源，提高可靠性）
  - 多视角分析（引导模型从不同角度、立场或专业视角分析问题，提供全面见解）
  - 多模态思维（结合不同表达形式进行思考，如文字描述、图表结构、代码逻辑等）
- 定期清理对话历史，在长对话过程中定期请求 AI 总结之前的对话，用总结来代替详细历史
- 对于大量文档场景不要直接整体作为提示词，而是使用向量数据库和检索技术，也就是 RAG 来获取相关段落
- 使用现有的提示词来自主优化提示词
    - 文本对话提示词库：https://docs.anthropic.com/en/home
    - 绘画对话提示词库：https://promptlibrary.org/
- 动态迭代优化提示词：通过逐步修改和完善提示词，提高输出质量
- 能力极限测试：通过极限情况测试模型的能力边界，找出优化空间
- 创建结构化模板：便于针对类似任务进行一致性提示，否则每次输出的内‌容可能会有比较大的区别，不利于调试
- 错误分析与修正：系统性分析模型回答中的错误，并针对性优化提示词
- 直接利用现有 AI 来辅助自己进行优化

> [!IMPORTANT]
> 
> 推荐阅读：
> - https://docs.spring.io/spring-ai/reference/api/prompt.html#_prompt_engineering
> - https://platform.openai.com/docs/guides/text?api-mode=responses

### 3.5.AI 的框架

主要是关于 SpringAI 的使用，这方面我的文档写得很详细...

## 4.设计方案

### 4.1.提示词动态模板功能

#### 4.1.1.优化提示词

首先在提示词的设计上就需要下一些功夫。

对于 AI 对话应用，最简单的做法是直接写一段系统预设，定义“‌你是谁？能做什么？”，但是这种做法不够灵活，但效果往往不够理想。想想现实中的场景，我们去找专家咨询时，专家可能会先主动抛出一系列引‌导性问题、深入了解背景，而不是被动等待用户完整描述问题。比如：

- 最近有什么迷茫的事情么？
- 请问你有什么需要我帮助的事么？
- 你们的感情遇到什么问题了么？

因此可以给出“扮演深耕恋爱心理领域的专家。开场向用户表明身份，告知用户可倾诉恋爱难题。围绕单身、恋爱、已婚三种状态提问：单身状态询问社交圈拓展及追求心仪对象的困扰；恋爱状态询问沟通、习惯差异引发的矛盾；已婚状态询问家庭责任与亲属关系处理的问题。引导用户详述事情经过、对方反应及自身想法，以便给出专属解决方案。”

#### 4.1.2.上下文记忆对话

用户会跟 AI 进行多轮对话，这时 AI 不能像失忆一样，而是要始终保持之前的对话内容作为上‌下文，不断深入了解用户，从而提供给用户更全面的建议。

如何使用对话记忆能力呢？参考 Spring AI 的官方文档，了解到 Spring AI 提供了 ChatClient API 来和 AI 大模型交互。

### 4.2.支持和用户基本的 AI 多轮对话功能

### 4.3.支持自主调用工具功能和 MCP 服务功能

### 4.4.支持 PDF 计划生成功能

### 4.5.支持自定义知识库对话功能

### 4.6.支持微信聊天记录导入转化功能

